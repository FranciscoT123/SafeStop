<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SafeStop AI Assistant</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f2f2f2;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
    }

    .container {
      width: 100%;
      max-width: 600px;
      margin-top: 2rem;
      background: white;
      padding: 1rem;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    h1 {
      text-align: center;
      color: #333;
    }

    .chat-history {
      min-height: 200px;
      max-height: 400px;
      overflow-y: auto;
      padding: 1rem;
      background: #f8f9fa;
      border-radius: 6px;
      margin-bottom: 1rem;
      display: flex;
      flex-direction: column;
    }

    .bubble {
      margin-bottom: 10px;
      padding: 10px;
      border-radius: 10px;
      max-width: 80%;
      word-wrap: break-word;
    }

    .user {
      background: #cce5ff;
      align-self: flex-end;
      text-align: right;
    }

    .ai {
      background: #e6f0ff;
      align-self: flex-start;
      text-align: left;
    }

    textarea {
      width: 100%;
      padding: 0.75rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      resize: vertical;
    }

    button {
      margin-top: 0.5rem;
      width: 100%;
      padding: 0.75rem;
      font-size: 1rem;
      background: #1d4ed8;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    button:hover {
      background: #2563eb;
    }

    .clear-btn {
      background: #ccc;
      margin-top: 0.5rem;
    }

    @media (max-width: 600px) {
      .container {
        margin: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üöî SafeStop AI Chat</h1>
    <div class="chat-history" id="chatHistory">
      <!-- Messages will appear here -->
    </div>
    <textarea id="userInput" rows="3" placeholder="Ask: Do I have to show ID?"></textarea>
    <button onclick="askBot()">Ask</button>
    <button class="clear-btn" onclick="clearChat()">Clear Chat</button>
  </div>

  <script>
    const lambdaUrl = "https://b2ufr7oxorprwmjap5uemsxadu0ixngv.lambda-url.us-west-2.on.aws/"; // Replace with your own if needed

    function appendMessage(content, sender = 'ai') {
      const history = document.getElementById("chatHistory");
      const bubble = document.createElement("div");
      bubble.classList.add("bubble", sender);
      bubble.innerText = content;
      history.appendChild(bubble);
      history.scrollTop = history.scrollHeight;
    }

    function clearChat() {
      document.getElementById("chatHistory").innerHTML = "";
    }

    async function askBot() {
      const message = document.getElementById("userInput").value.trim();
      const responseBox = document.getElementById("chatHistory");
      if (!message) return;

      appendMessage(message, 'user');
      appendMessage("‚è≥ Waiting for response...", 'ai');

      try {
        const res = await fetch(lambdaUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message })
        });

        const text = await res.text();
        const bubbles = responseBox.querySelectorAll(".ai");
        const latest = bubbles[bubbles.length - 1];

        try {
          const data = JSON.parse(text);
          latest.textContent = "üß† " + (data.response || "No reply.");
        } catch {
          latest.textContent = "‚ö†Ô∏è Unexpected response format\n" + text;
        }

      } catch (err) {
        const bubbles = responseBox.querySelectorAll(".ai");
        const latest = bubbles[bubbles.length - 1];
        latest.textContent = "‚ö†Ô∏è Network error: " + err.message;
      }

      document.getElementById("userInput").value = "";
    }
  </script>
</body>
</html>
